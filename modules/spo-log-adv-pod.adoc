// Module included in the following assemblies:
//
// * security/security_profiles_operator/spo-logging.adoc

:_mod-docs-content-type: PROCEDURE
[id="spo-log-adv-pod_{context}"]
= Advanced Audit Logs for a specific pod

[role="_abstract"]
To enable single pod log activity, create a `SeccompProfile` to log specific syscalls such as `execve` and clone a `ProfileBinding` to automatically apply this profile to pods in a target namespace. The `SeccompProfile` applies to the cluster and the `ProfileBinding` applies to the workloads in that namespace.

With CRI-O versions 1.33 and newer, starting with {product-title} 4.20, a feature was introduced to allow `SeccompProfiles` for privileged containers. You can apply the `SecompProfile` we created to the CRI-O configuration. The key is to configure the CRI-O runtime to use the profile by passing an additional flag.

To do this, you must add the flag `â€“privileged-seccomp-profile` to the CRI-O runtime configuration. This step ensures that even privileged debugging pods are subject to the `SeccompProfile` logging, maintaining complete audit coverage.

You must bind the profile to a namespace in order to apply it to a workload. This will automatically apply the profile to new pods in the default namespace.

.Procedure

. Create a file such as `profile1.yaml` with the following content:
+
[source,yaml]
----
apiVersion: security-profiles-operator.x-k8s.io/v1beta1
kind: SeccompProfile
metadata:
  name: profile1
  namespace: openshift-security-profiles
spec:
  defaultAction: SCMP_ACT_ALLOW
  syscalls:
  - action: SCMP_ACT_LOG
    names:
      - execve
      - clone
      - getpid
----
+
This profile allows all normal actions (`defaultAction: SCMP_ACT_ALLOW`). It specifically tells the system to log when a process tries to run a new program (`execve`), create a new process (`clone`), or get its own process ID (`getpid`). These actions often indicate user interaction within a pod.

. Use`kubectl apply` to apply this `SeccompProfile` profile to your cluster as in the following command:
+
[source,terminal]
----
# kubectl apply -f profile1.yaml
----
+
[NOTE]
====
SPO must use the privileged `SeccompProfile`
====

. Create a file named `image_sec_comp.yaml` containing the following `yaml`:
+
[source,yaml]
----
apiVersion: security-profiles-operator.x-k8s.io/v1alpha1
kind: ProfileBinding
metadata:
  namespace: default
  name: all-pod-binding
spec:
  profileRef:
    kind: SeccompProfile
    name: profile1
  image: "*"
----

. Apply the binding using the following command:
+
[source,terminal]
----
# kubectl apply -f image_sec_comp.yaml
----

. Label the namespace to activate it using the following command:
+
[source,terminal]
----
# kubectl label ns default spo.x-k8s.io/enable-binding=true
----

. Create a pod using the profile:
+
[source,yaml]
----
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  labels:
    app: my-app
spec:
  securityContext:
    SeccompProfile:
      type: Localhost
      localhostProfile: operator/profile1.json
  containers:
    - name: nginx
      image: quay.io/security-profiles-operator/test-nginx:1.19.1
----

** type: `Localhost` means you are using a profile you have defined in the cluster.

** localhostProfile: `operator/profile1.json` tells the pod to use the profile1 you created. The `operator/` part indicates where the Security Profiles Operator stores these profiles.

. Apply the pod definition to create the pod by running the following command:
+
[source,terminal]
----
# kubectl apply -f my-pod.yaml
----
. Exec/rsh into the pod and run the following command:
+
[source,terminal]
----
# kubectl exec -it my-nginx-pod -- /bin/sh
----
. Create an empty file by running this command:
+
[source,terminal]
----
# touch /tmp/audittest/demo-file
----
+
** To monitor the advanced audit log tail, use the following command:
+
[source,terminal]
----
# kubectl -n openshift-security-profiles logs --since=1m --selector name=spod -c json-enricher --max-log-requests 6 -f
----
+
** Alternatively, to monitor or inspect the advanced audit log file, you need to identify the node on which the pod is scheduled:
+
[source,terminal]
----
# kubectl get pod my-pod -o wide
----
+
The audit log file specified in the `auditLogPath` is written to the node's file system where the pod is running. To monitor or inspect the audit logs, you must access the node directly and check the file at the specified path such as `/tmp/logs/audit1.log`.
+
. SSH to a node by using the following command:
+
[source,terminal]
----
$ sudo ssh core@<node-name>
----

. View the audit log by using the following command:
+
[source,terminal]
----
$ cat /tmp/logs/audit1.log
----
+
Example output
+
[source,terminal]
----
{
"auditID": "a1b2c3d4-e5f6-7890-abcd-111111111111",
"cmdLine": "mkdir /tmp/audittest ",
"executable": "/bin/bash",
"gid": 0,
"node": {"name": "worker-1"},
"pid": 27184,
"requestUID": "f011c4a3-b20e-44ed-bb91-23e03ae31b3e",
"resource": {
"container": "nginx",
"namespace": "default",
"pod": "my-pod"
},
"syscalls": ["getpid", "execve"],
"timestamp": "2026-02-16T06:34:53.000Z",
"uid": 0,
"version": "spo/v1_alpha"
}
{
"auditID": "a1b2c3d4-e5f6-7890-abcd-222222222222",
"cmdLine": "touch /tmp/audittest/demo-file ",
"executable": "/bin/bash",
"gid": 0,
"node": {"name": "worker-1"},
"pid": 27274,
"requestUID": "f011c4a3-b20e-44ed-bb91-23e03ae31b3e",
"resource": {
"container": "nginx",
"namespace": "default",
"pod": "my-pod"
},
"syscalls": ["getpid", "execve"],
"timestamp": "2026-02-16T06:35:02.000Z",
"uid": 0,
"version": "spo/v1_alpha"
}
----
By following above steps, you can enable and monitor audit logs in JSON lines format for your Kubernetes pods, giving you better visibility into their activities.
