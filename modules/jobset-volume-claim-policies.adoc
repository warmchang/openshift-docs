// Module included in the following assemblies:
//
// * ai_workloads/jobset_operator/managing-jobset.adoc

:_mod-docs-content-type: PROCEDURE
[id="js-volume-claim-policies_{context}"]
= Configuring volume claim policies for {js-operator}

[role="_abstract"]
You can configure a JobSet to automatically create and manage shared persistent volume claims (PVCs) across multiple replicated jobs. This is useful for workloads that require shared access to datasets, models, or checkpoints.

.Prerequisites

* You have the {js-operator} installed in your cluster.
* You have set a default storage class or chosen a storage class for your workload.

.Procedure

. Define the volume templates in the `spec.volumeClaimPolicies` section of your JobSet YAML file.
+
[source,yaml]
----
apiVersion: jobset.x-k8s.io/v1alpha2
kind: JobSet
metadata:
  name: <job_name>
spec:
  volumeClaimPolicies:
    - templates:
        - metadata:
            name: <persistent_volume_claim_name_prefix>
          spec:
            accessModes: ["ReadWriteOnce"]
            storageClassName: mystorageclass
            resources:
              requests:
                storage: 1Gi
      retentionPolicy:
        whenDeleted: Retain
----
+
where:
+
--
`<job_name>`:: Specifies your unique identifier for your jobs within your namespace.
`<persistent_volume_claim_name>`:: Specifies the name for the PVC. The name used here will also be used as the `volumeMounts` name. A volume will be automatically added to the pod that will mount a PVC created with a name in the format of `<persistent_volume_claim_name>-<job_name>`.
`<deletion_retention_policy>`:: Specifies the deletion retention policy. Optionally, you can keep data after the JobSet is deleted by setting this value to `Retain`.
--

. In your `replicatedJobs` configuration, add a `volumeMount` that matches the template name you defined.
+
[source,yaml]
----
apiVersion: jobset.x-k8s.io/v1alpha2
kind: JobSet
metadata:
  name: <job_name>
spec:
  replicatedJobs:
  - name: workers
    template:
      spec:
        parallelism: 2
        completions: 2
        backoffLimit: 0
        template:
          spec:
            imagePullSecrets:
              - name: my-registry-secret
            initContainers:
              - name: prepare
                image: docker.io/alpine/git:v2.52.0
                args: ['clone', 'https://github.com/pytorch/examples']
                volumeMounts:
                  - name: <persistent_volume_claim_name>
                    mountPath: /git/checkpoint
#...
----

. Apply the JobSet configuration by running the following command:
+
[source,terminal]
----
$ oc apply -f <jobset_yaml>
----

.Verification

* Verify that the PVCs were created using the naming convention `<claim_name>-<jobset_name>`:
+
[source,terminal]
----
$ oc get pvc
----
+
.Example output
[source,terminal]
----
NAME          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc-1       Bound    pvc-385996a0-70af-4791-aa8e-9e6459e6b123   3Gi        RWO            file-storage   3d
pvc-2       Bound    pvc-8aeddd4d-aad5-4039-8d04-640a71c9a72d   12Gi       RWO            file-storage   3d
pvc-3       Bound    pvc-0050144d-940c-4c4e-a23a-2a660a5490eb   12Gi       RWO            file-storage   3d
----