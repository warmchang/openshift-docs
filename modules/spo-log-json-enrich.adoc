// Module included in the following assemblies:
//
// * security/security_profiles_operator/spo-logging.adoc

:_mod-docs-content-type: PROCEDURE
[id="spo-log-json-enrich_{context}"]
= Audit JSON Log Enricher configuration

[role="_abstract"]
The Audit JSON Log Enricher requires some configuration to set interval, configure the destination of the log data and set the audit log file path. This procedure demonstrates how to set up and fine tune your Advanced Audit Logging Framework audit logs.

[NOTE]
====
Each configuration change triggers a restart of the SPOD pods. After applying a patch, wait for all SPOD pods to return to the `Running` state before continuing.
====

Setting the audit log interval determines how often audit logs are created using the `auditLogIntervalSeconds` option.

.Procedure

. Configure the audit log interval to 30 seconds by using the following command:
+
[source,terminal]
----
# kubectl -n openshift-security-profiles patch spod spod --type=merge -p '{"spec":{"enableJsonEnricher":true,"verbosity":0,"jsonEnricherOptions":{"auditLogIntervalSeconds":30}}}'
----
+
Wait until all SPOD pods show `Running` before proceeding. By default, audit logs go to your standard output in JSON lines format. You can send them to a file instead.
+
Configure the security profiles operator to store the log file on the node. Update the security-profiles-operator-profile `ConfigMap` with two keys. This example `yaml` uses both keys to set up a host path volume at `/tmp/logs`.

. Save this JSON in a file, such as `patch-volume-source.json` and check it using the following command:
+
[source,terminal]
----
$ cat patch-volume-source.json
----
+
[source,yaml]
----
{
  "data": {
    "json-enricher-log-volume-mount-path": "/tmp/logs",
    "json-enricher-log-volume-source.json": "{\"hostPath\": {\"path\": \"/tmp/logs\",\"type\": \"DirectoryOrCreate\"}}"
  }
}
----
** `json-enricher-log-volume-source.json`: Defines the type of volume (for example, a host path and empty directory) where logs will be stored. This must be a JSON string representing a `corev1.VolumeSource` object.
** `json-enricher-log-volume-mount-path`: Specifies the directory path where the log file will be generated.
+
. Update the config map by saving this JSON in this file called `patch-volume-source.json` and then update the config map with the following command:
+
[source,terminal]
----
# kubectl patch configmap security-profiles-operator-profile -n openshift-security-profiles --patch-file patch-volume-source.json
----
+
Wait until all SPOD pods show `Running` before proceeding.
+
. To set the audit log file path, configure the JSON log enricher with the full path to your audit log file by including the filename, using this command:
+
[source,terminal]
----
# kubectl -n openshift-security-profiles patch spod spod --type=merge -p '{"spec":{"enableJsonEnricher":true,"verbosity":0,"jsonEnricherOptions":{"auditLogPath":"/tmp/logs/audit1.log"}}}'
----
+
Wait until all SPOD pods show `Running` before proceeding
